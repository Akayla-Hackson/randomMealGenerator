<!DOCTYPE html>
<html>
<style>

#title1 {
position: fixed;
color: blue;
left:36%;
top:1%;
padding:2px;
}

@import "bourbon";

body {
	background: #eee !important;	
}

#signDisplay{
    position: fixed;
    background-color: #fff;
    width: 30%;
    margin: 80px auto;
    border-radius: 10px;
    padding: 20px;
    border-left: 5px solid #009688;
    box-shadow: 0px 0px 0px 0px #3f51b5;
    left: 35%;
    top:13%;
}
.login>.row>h2 {
    margin: auto;
}

.btn-form {
    width: 100%;
    margin-top: 20px;
}
#displayMessage {
    position: fixed;
    top:48%;
    left:30%;
    text-size: 400px;
}
#refreshButton {
position: fixed;
top: 20%;
left:70%;
padding: 10px;
}

</style>

    <head>
	     <script src="https://code.jquery.com/jquery-3.6.0.js" 
		     integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
	     <script src="/static/cis444.js"></script>
	     <!-- Required meta tags -->
    	     <meta charset="utf-8">
    	     <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	     <!-- Bootstrap CSS -->
    	     <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        		integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    </head>
    <body>
	<h1 id=title1>Akayla's Meal Helper</h1>      
	<!-- signup setup -->
		<div class="container2" id="signDisplay">
                        <div class="login">
                                <div class="row">
                                        <h2>Please Sign In</h2>
					<div class="col-md-12">        
	    					<form >
  						<label for="fname">Username:</label><br>
  							<input type="text" id="user" name="username" value="Ak"><br>
  						<label for="password">Password:</label><br>
  							<input type="password" id="password" name="password" value="password"><br><br>
  					</div>
					<div class="col-md-6">	
							<input type="submit" value="Sign In" onclick="return send_form();">
							<p id="loginError" style="display: none;">Login Failed. Try again!"</p>
					</div>
						</form>
	    			</div>
			</div>
		</div>


		<table align="center" id="stage" style="display=none;">
			<tr>
				<td><img id="SlotImage1" src="bar.jpg" alt="Slot Image #1" style="Width:102px; Height:132px;"></td>
				<td><img id="SlotImage2" src="bar.jpg" alt="Slot Image #2" style="Width:102px; Height:132px;"></td>
				<td><img id="SlotImage3" src="bar.jpg" alt="Slot Image #3" style="Width:102px; Height:132px;"></td>
			</tr>
			<tr>
				<td></td>
				<td><input type="button" onclick="DoSpin()" value="Click To Spin"></td>
				<td></td>
			</tr>
			<tr>
				<td>Money:</td>
				<td><input type="text" onchange="checkMoney()" style="width: 100px" name="money" value="20"></td>
				<td></td>
			</tr>
			<tr>
				<td>Bet:</td>
				<td><input type="text" onchange="checkBet()" style="width: 100px" name="bet" value="1"></td>
				<td></td>
			</tr>
		</table>

		<button id="refreshButton" type="button" style="display: none;" onclick= "getLoginPage()">Back To Login</button>
	<script>
                function send_form(){
                        $.post("/open_api/login", { "username":$('#user').val(), "password":$('#password').val()},
                                function(data, textStatus) {
                                        //this gets called when browser receives response from server
                                        console.log(data.token);
                                        jwt = data.token;
                                        console.log(data);
                                        noError();
                                        goToMainPage();
                                        //make secure call with the jwt

                                }, "json").fail( function(response) {
                                        //this gets called if the server throws an error
                                        console.log("error");
                                        displayError();
                                        console.log(response);
                                });
                        return false;
                }

                
		function displayError(){
                        var loginError = document.getElementById("loginError");
                        loginError.style.display = "block";
                }
                
                function noError(){
                        var loginError = document.getElementById("loginError");
                        loginError.style.display = "none";

                }
                function goToMainPage(){
                        var signDisplay = document.getElementById("signDisplay");
                        signDisplay.style.display = "none";
			var stage = document.getElementById("stage");
                        stage.style.display = "block";
		}
		function restyle()
		{
                        var signupContainer = document.getElementById("signDisplay");
                        signupContainer.style.display = "none";
			var refreshButton = document.getElementById("refreshButton");
			refreshButton.style.display = "block";
			var stage = document.getElementById("stage");
                        stage.style.display = "none";
		}
		function getLoginPage()
		{
                        var signupContainer = document.getElementById("signDisplay");
                        signupContainer.style.display = "block";
                        var refreshButton = document.getElementById("refreshButton");
                        refreshButton.style.display = "none";
			var stage = document.getElementById("stage");
                        stage.style.display = "none";
		}
		function DoSpin() {
				//All three slotâ€™s images should be randomly selected 
				//and displayed on the page.
				//If all three images match, alert the user of a win.
				
				var money = parseInt(document.getElementsByName('money')[0].value);
				var bet = parseInt(document.getElementsByName('bet')[0].value);
				var slotImages = ["bar.jpg", "cherry.jpg", "donut.jpg", "lemon.jpg"];
				
				if (money > 0) {
					document.getElementsByName('money')[0].value = money - bet;
					//keys: 0=bar, 1=cherry, 2=donut, 3=lemon
					var slotImage1 = Math.floor((Math.random() * 4));
					var slotImage2 = Math.floor((Math.random() * 4));
					var slotImage3 = Math.floor((Math.random() * 4));
				
					document.getElementById('SlotImage1').src = slotImages[slotImage1];
					document.getElementById('SlotImage2').src = slotImages[slotImage2];
					document.getElementById('SlotImage3').src = slotImages[slotImage3];
			
					CheckWinner(slotImage1,slotImage2,slotImage3,money,bet);
				}
				else {
					//out of money
					alert('You lose. Enter more money to keep playing.');
				}	
			}
			
			function CheckWinner(x,y,z,money,bet) {
				if (x == y && x == z) {
					document.getElementsByName('money')[0].value = money + (13 * bet);
					alert('YOU WIN!');
				}
			}
			
			function checkBet() {
				var bet = parseInt(document.getElementsByName('bet')[0].value)
				//check if the user entered a valid numerical bet
				if (isNaN(bet)){
					//bet is not a number
					alert('Please enter bet as a numerical value.');
				}
				else {
					if (bet <= 0){
						// bet too low
						alert('Your bet is too low.');
					}
					else{
						if(bet > parseInt(document.getElementsByName('money')[0].value)){
							//bet too large
							alert('You do not have enough money to place a bet this large.');
						}		
					}
				}
			}
			
			function checkMoney() {
				var money = parseInt(document.getElementsByName('money')[0].value)
				//check if the user entered a valid numerical value for money
				if (isNaN(money)){
					//money is not a number
					alert('Please enter money as a numerical value.');
				}
				else {
					if (money <= 0){
						// money entered was too low
						alert('Please add a valid amount of money to the game.');
					}
				}
			}
	</script>
    </body>
</html>

